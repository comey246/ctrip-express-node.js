import{r as i,W as F,b as N,L as $,j as e,M as a,ay as M,av as l,B as S,aA as R,aB as p,aC as L,aD as T,aE as H,aq as j,U as q}from"./index-f1a77953.js";import{S as D}from"./index-b325027d.js";import{b as V,a as U,c as W}from"./mall-3334e9f8.js";import{D as d}from"./index-e7d1e950.js";import{P as X,a as G,b as J}from"./index-2f76128d.js";var K={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M869 487.8L491.2 159.9c-2.9-2.5-6.6-3.9-10.5-3.9h-88.5c-7.4 0-10.8 9.2-5.2 14l350.2 304H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h585.1L386.9 854c-5.6 4.9-2.2 14 5.2 14h91.5c1.9 0 3.8-.7 5.2-2L869 536.2a32.07 32.07 0 000-48.4z"}}]},name:"arrow-right",theme:"outlined"};const Q=K;var C=function(t,o){return i.createElement(F,N(N({},t),{},{ref:o,icon:Q}))};C.displayName="ArrowRightOutlined";const Y=i.forwardRef(C);var Z={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 632H136V232h752v560zM610.3 476h123.4c1.3 0 2.3-3.6 2.3-8v-48c0-4.4-1-8-2.3-8H610.3c-1.3 0-2.3 3.6-2.3 8v48c0 4.4 1 8 2.3 8zm4.8 144h185.7c3.9 0 7.1-3.6 7.1-8v-48c0-4.4-3.2-8-7.1-8H615.1c-3.9 0-7.1 3.6-7.1 8v48c0 4.4 3.2 8 7.1 8zM224 673h43.9c4.2 0 7.6-3.3 7.9-7.5 3.8-50.5 46-90.5 97.2-90.5s93.4 40 97.2 90.5c.3 4.2 3.7 7.5 7.9 7.5H522a8 8 0 008-8.4c-2.8-53.3-32-99.7-74.6-126.1a111.8 111.8 0 0029.1-75.5c0-61.9-49.9-112-111.4-112s-111.4 50.1-111.4 112c0 29.1 11 55.5 29.1 75.5a158.09 158.09 0 00-74.6 126.1c-.4 4.6 3.2 8.4 7.8 8.4zm149-262c28.5 0 51.7 23.3 51.7 52s-23.2 52-51.7 52-51.7-23.3-51.7-52 23.2-52 51.7-52z"}}]},name:"idcard",theme:"outlined"};const ee=Z;var z=function(t,o){return i.createElement(F,N(N({},t),{},{ref:o,icon:ee}))};z.displayName="IdcardOutlined";const te=i.forwardRef(z);const ae=n=>{const{item:t,checkFlight:o}=n;return e("div",{className:"flight-item",children:a(M,{align:"middle",justify:"center",gutter:[16,16],children:[a(l,{xs:24,sm:12,md:6,lg:6,xl:6,children:[e("div",{className:"plane-model",children:t.airline}),a("div",{className:"plane-model",children:[e("span",{style:{color:"red"},children:t.flight_number})," ",t.planeModel]})]}),e(l,{xs:8,sm:4,md:2,lg:2,xl:2,children:e("div",{className:"departure-time",children:t.departure_time})}),a(l,{xs:8,sm:4,md:3,lg:3,xl:3,children:[e("h3",{children:e(Y,{className:"arrow-icon",style:{width:60}})}),e("div",{className:"duration",children:t.duration})]}),e(l,{xs:8,sm:4,md:3,lg:3,xl:3,children:e("div",{className:"departure-time",children:t.arrival_time})}),e(l,{xs:12,sm:6,md:4,lg:4,xl:4,children:a("div",{className:"price",children:["¥",t.price]})}),e(l,{xs:12,sm:6,md:3,lg:3,xl:3,children:a("div",{className:"seat",children:["余票：",t.seats_available]})}),e(l,{xs:12,sm:6,md:3,lg:3,xl:3,children:e("div",{className:"book-button",children:e(S,{style:{width:"100%"},type:"primary",onClick:()=>o(t),children:"订票"})})})]})})},ie=n=>n.mall,ne=$(ie)(ae);const le=n=>{const{ticket:t,ModalOpen:o,close:w,open:k}=n,[s,u]=i.useState(1),[f,r]=i.useState(!1),h=async m=>{r(!0);try{const{code:O,data:{order:x},message:y}=await V({tickets:s,...m,...t});O===200?k(x):(y.error(y),w())}finally{r(!1)}},b=()=>{w()},v=m=>{console.log("Failed:",m)};return a("div",{className:"ticket-booking",children:[e("h1",{children:"机票预订"}),e("div",{className:"order-info",children:a(R,{spinning:f,tip:"Loading...",children:[a(d,{title:"航班信息",children:[e(d.Item,{label:"航班号",children:t.flight_number}),e(d.Item,{label:"航空公司",children:t.airline}),e(d.Item,{label:"飞机型号",children:t.planeModel}),e(d.Item,{label:"起飞时间",children:t.departure_time}),e(d.Item,{label:"起飞地点",children:t.originLabel}),e(d.Item,{label:"到达时间",children:t.arrival_time}),e(d.Item,{label:"到达地点",children:t.destinationLabel}),e(d.Item,{label:"余票",children:t.seats_available})]}),"          "]})}),a("div",{className:"flight-info",children:[a("p",{children:["价格：",t.price]}),a("div",{className:"ticket-control",children:[e("button",{onClick:()=>u(s-1),disabled:s<=1,children:"-"}),e("input",{type:"number",id:"tickets",value:s,onChange:m=>u(m.target.value),min:"1",max:"100"}),e("button",{onClick:()=>u(s+1),disabled:s>t.seats_available-1,children:"+"})]})]}),a(p,{name:"flight",initialValues:{remember:!0},onFinish:h,onFinishFailed:v,autoComplete:"off",children:[e(p.Item,{name:"name",rules:[{required:!0,message:"请输入姓名！"},{pattern:new RegExp(/^[\u4e00-\u9fa5]{2,}$/),message:"请输入正确的姓名"}],children:e(L,{size:"large",prefix:e(T,{className:"site-form-item-icon"}),placeholder:"姓名"})}),e(p.Item,{name:"phone",rules:[{required:!0,message:"请输入手机号！"},{pattern:new RegExp(/^(13\d|14[5-9]|15[^4\D]|16\d|17[135678]|18\d|19[89])\d{8}$/),message:"请输入合法手机号"}],children:e(L,{size:"large",prefix:e(H,{className:"site-form-item-icon"}),placeholder:"手机"})}),e(p.Item,{name:"idNumber",rules:[{required:!0,message:"请输入身份证号！"},{pattern:new RegExp(/(^\d{15}$)|(^\d{17}([0-9]|X|x)$)/),message:"请输入合法身份证"}],children:e(L,{size:"large",prefix:e(te,{className:"site-form-item-icon"}),placeholder:"身份证"})}),e(p.Item,{children:a(M,{children:[e(l,{span:6,children:a("span",{className:"totalprice",children:["总价：¥",t.price*s]})}),e(l,{span:6,offset:2,children:e(S,{onClick:b,className:"login-form-button",children:"取消"})}),e(l,{span:6,offset:2,children:e(S,{type:"primary",htmlType:"submit",className:"login-form-button",children:"下单"})})]})})]})]})};const se={flight_number:"",airline:"",planeModel:"",origin:"",originLabel:"",destination:"",destinationLabel:"",date:"",departure_time:"",arrival_time:"",duration:"",price:0,seats_available:0},re=n=>{const t=j(),[o,w]=i.useState(!1),[k,s]=i.useState(se),[u,f]=i.useState(!1),[r,h]=i.useState(0),[b,v]=i.useState(""),[m,O]=i.useState([]),{flightInfo:x,token:y}=n,A=async c=>{if(y==="")return q.warning("请先登录或注册"),t("/login");f(!0);try{const{data:{flight:g}}=await U({flightNumber:c.flight_number});s(g),h(1)}finally{f(!1)}},I=()=>{h(0)},P=c=>{h(2),v(c)},E=(c,g)=>{h(c),v(g)},B=async()=>{var _;const g=(_=(await W(x)).data)==null?void 0:_.flightList;O(g)};if(i.useEffect(()=>{B()},[r,x]),r===0)return e(R,{spinning:u,children:m.map(c=>e(ne,{item:c,checkFlight:A},c.flight_number))});if(r===1)return e(le,{ticket:k,close:I,ModalOpen:o,open:P});if(r===2)return e(X,{order:b,payResult:E,handleCancel:I});if(r===3)return e(G,{order:b,handleCancel:I});if(r===-1)return e(J,{handleCancel:I})},ce=n=>({...n.mall,...n.global}),de=$(ce)(re);const pe=n=>a(i.Fragment,{children:[e(D,{}),e(de,{})]});export{pe as default};
